(()=>{"use strict";var e={d:(t,a)=>{for(var n in a)e.o(a,n)&&!e.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:a[n]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};e.d({},{u:()=>d,E:()=>u});let t=0;const a={all:JSON.parse(localStorage.getItem("dev.finances:transactions"))||[],add(e){a.all.push(e),i.reload()},remove(e){a.all.splice(e,1),i.reload()},incomes(){let e=0;return a.all.forEach((t=>{t.amount>0&&(e+=t.amount)})),e},expenses(){let e=0;return a.all.forEach((t=>{t.amount<0&&(e+=t.amount)})),e},total(){let e=a.incomes()+a.expenses();return n(e),e}},n=e=>{const a=document.querySelector(".card.total");e<0&&t<=3?(a.classList.add("changeColor"),setTimeout(u.open,500),t++):e<0?a.classList.add("changeColor"):a.classList.remove("changeColor")},r={formatAmount:e=>(e*=100,Math.round(e)),format(e){const t=e.split("-");return`${t[2]}/${t[1]}/${t[0]}`},reverseDate(e){const t=e.split("/");return`${t[2]}-${t[1]}-${t[0]}`},formatCurrency(e){const t=Number(e)<0?"-":"";return e=String(e).replace(/\D/g,""),t+(e=Number(e)/100).toLocaleString("pt-BR",{style:"currency",currency:"BRL"})}},o={select:document.querySelector(".input-group.actions"),clear(){document.querySelector("button").removeEventListener("click",(e=>{try{c.validateField(),a.remove(e.target.className)}catch(e){console.log(e)}})),this.select.innerHTML=this.originInput(),i.reload()},addInput(e){this.select.innerHTML=this.NewInput(e),document.querySelector(".button.cancel.in-modal").addEventListener("click",(()=>{this.clear(),d.close()})),document.querySelector("button").addEventListener("click",(e=>{try{c.validateField(),a.remove(e.target.className)}catch(e){console.log(e)}}))},NewInput:e=>`\n        <a href="#" class="button cancel in-modal">Cancelar</a>\n        <button class="${e}">Enviar</button>`,originInput:()=>'\n        <a href="#" class="button cancel">Cancelar</a>\n        <button>Enviar</button>'},c={description:document.querySelector("input#description"),amount:document.querySelector("input#amount"),typeTransaction:document.getElementsByName("transaction-type"),date:document.querySelector("input#date"),getValue(){let e="";return this.typeTransaction.forEach((t=>{t.checked&&(e=t.value)})),{description:c.description.value,amount:c.amount.value,typeTransaction:e,date:c.date.value}},validateField(){const{description:e,amount:t,date:a}=this.getValue();if(""===e.trim()||""===t.trim()||""===a.trim())throw new Error("Por favor, preencha todos os campos!")},formatValues(){let{description:e,amount:t,typeTransaction:a,date:n}=this.getValue();return t=r.formatAmount(t),t="income"===a&&t<0?-1*t:t,t="expense"===a&&t>0?t-2*t:t,n=r.format(n),{description:e,amount:t,typeTransaction:a,date:n}},clearFields(){c.description.value="",c.amount.value="",c.date.value=""},submit(e){e.preventDefault();try{c.validateField();const e=c.formatValues();a.add(e),c.clearFields(),d.close(),o.clear()}catch(e){setTimeout((()=>{document.querySelector(".error").classList.add("active"),document.querySelector(".error.active span").innerHTML=e.message,""==c.description.value.trim()&&c.description.classList.add("red"),""===c.amount.value.trim()&&c.amount.classList.add("red"),""===c.date.value.trim()&&c.date.classList.add("red")}),0),setTimeout((()=>{document.querySelector(".error").classList.remove("active");const e=document.querySelectorAll(".border.red");e||(e[0].classList.remove("red"),e[1].classList.remove("red"),e[2].classList.remove("red"))}),3e3)}}},s={tableBody:document.querySelector("#data-table tbody"),addTransaction(e,t){const a=document.createElement("tr");a.innerHTML=this.innerHTMLTransaction(e,t),a.dataset.index=t,s.tableBody.appendChild(a)},edit(e){d.open();let{description:t,amount:n,typeTransaction:s,date:l}=a.all[e];c.description.value=t,c.amount.value=n/100,c.date.value=r.reverseDate(l),"income"===s?document.getElementById("income").setAttribute("checked",""):document.getElementById("expense").setAttribute("checked",""),o.addInput(e)},innerHTMLTransaction(e,t){const a=e.amount>0?"income":"expense",n=r.formatCurrency(e.amount);return`\n        <td class="description">${e.description}</td>\n        <td class= "${a}">${n}</td>\n        <td class="date">${e.date}</td>\n        <td><img src="./assets/pencil.svg" alt="Modifique esta transação" id="edit" class="${t}"></td>\n        <td><img src="./assets/minus.svg" alt="Remover esta transação" id="remove" class="${t}"></td>`},updateBalance(){document.getElementById("cardIncome").innerHTML=r.formatCurrency(a.incomes()),document.getElementById("cardExpense").innerHTML=r.formatCurrency(a.expenses()),document.getElementById("cardTotal").innerHTML=r.formatCurrency(a.total())},cleanUp(){this.tableBody.innerHTML=""}},l={Css(){let e=a.all.length;document.body.appendChild(document.createElement("style")).innerHTML=e>=4?"\n        .new.button{\n            opacity: 1;\n            visibility: visible;\n        }\n        #newTransaction{\n            width: 1px;\n            height: 1px;\n            opacity: 0;\n            visibility: hidden;\n        }\n        ":""}},i={init(){a.all.forEach(((e,t)=>{s.addTransaction(e,t)})),document.querySelectorAll("img#edit").forEach((e=>{e.addEventListener("click",(e=>{s.edit(e.target.classList)}))})),document.querySelectorAll("img#remove").forEach((e=>{e.addEventListener("click",(e=>{a.remove(e.target.classList)}))})),localStorage.setItem("dev.finances:transactions",JSON.stringify(a.all)),s.updateBalance(),l.Css()},reload(){s.cleanUp(),i.init()}},d={open(){document.querySelector(".modal-overlay").classList.add("active")},close(){document.querySelector(".modal-overlay").classList.remove("active"),c.clearFields()}},u={open(){document.querySelector(".layerMensage").classList.add("active")},close(){document.querySelector(".layerMensage").classList.remove("active")}};window.addEventListener("click",(e=>{"new button"===e.target.className&&d.open(),"newTransaction"!==e.target.className&&"newTransactionImg"!==e.target.className||d.open(),"button cancel"===e.target.className&&d.close(),"layerMensage active"===e.target.className&&u.close()})),document.querySelector("#form").addEventListener("submit",(e=>{c.submit(e)})),i.init()})();